<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lovely ‚Äî Happy Birthday</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!-- Dancing Script cho ti√™u ƒë·ªÅ + Playpen Sans cho n·ªôi dung -->
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Playpen+Sans:wght@400;700&display=swap" rel="stylesheet">
  <meta name="theme-color" content="#ffd9e8">
  <style>
    *{box-sizing:border-box}
    html, body{height:100%}
    body{
      margin:0; overflow:hidden; color:#fff;
      font-family:"Playpen Sans", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
       background: radial-gradient(circle at center, #b5179e 0%, #4a0e73 55%, #140022 100%);

    }

    /* N·ªÅn matrix */
    canvas#matrix{position:fixed; inset:0; z-index:0; pointer-events:none;}
    #fx{
      position:fixed; inset:0; z-index:1; pointer-events:none;
    }
    /* Ti√™u ƒë·ªÅ Happy Birthday (Dancing Script) */
    h1.title{
      position:fixed; top:10px; left:50%; transform:translateX(-50%); z-index:3;
      margin:0;
      margin-top: -10px;
      font-family:"Dancing Script", cursive;
      font-weight:700;
      font-size:clamp(32px, 5vw, 64px);
        color:#ff66a8;                /* h·ªìng d·ªÖ th∆∞∆°ng h∆°n */
    text-shadow:
    0 2px 10px rgba(255,105,180,.55),
    0 0 26px rgba(255,105,180,.38);
      white-space:nowrap;
      letter-spacing:.3px;
    }

    /* Ch·ªØ th·∫£ r∆°i ngay d∆∞·ªõi ti√™u ƒë·ªÅ */
    .rainWrap{
      position:fixed; top:calc(18px + clamp(32px, 5vw, 64px) + 6px); left:50%;
      transform:translateX(-50%); z-index:3;
      margin-top: 10px;
      height:46px; display:grid; place-items:center; overflow:hidden;
      width:min(900px, 94vw);
    }
    .rain{
      position:relative; display:flex; justify-content:center; gap:8px;
      filter: drop-shadow(0 6px 10px rgba(255,105,180,.25));
      pointer-events:none;
    }
    .drop{
      font-family:"Dancing Script", cursive;
      font-size:clamp(18px, 3.2vw, 30px);
      opacity:0; transform: translateY(-40px);
      animation: fall 2.6s ease-in-out infinite;
      white-space:pre;
      color:#ff66a8;
      text-shadow: 0 1px 6px rgba(255,105,180,.35);
      
    }
    @keyframes fall{
      0%   { opacity:0; transform: translateY(-40px) }
      15%  { opacity:1; transform: translateY(0) }
      65%  { opacity:1; transform: translateY(0) }
      100% { opacity:0; transform: translateY(40px) }
    }
    .drop:nth-child(1){ animation-delay:.0s }
    .drop:nth-child(2){ animation-delay:.1s }
    .drop:nth-child(3){ animation-delay:.2s }
    .drop:nth-child(4){ animation-delay:.3s }
    .drop:nth-child(5){ animation-delay:.4s }
    .drop:nth-child(6){ animation-delay:.5s }
    .drop:nth-child(7){ animation-delay:.6s }
    .drop:nth-child(8){ animation-delay:.7s }
    .drop:nth-child(9){ animation-delay:.8s }
    .drop:nth-child(10){ animation-delay:.9s }
    .drop:nth-child(11){ animation-delay:1.0s }
    .drop:nth-child(12){ animation-delay:1.1s }
    .drop:nth-child(13){ animation-delay:1.2s }
    .drop:nth-child(14){ animation-delay:1.3s }
    .drop:nth-child(15){ animation-delay:1.4s }
    .drop:nth-child(16){ animation-delay:1.5s }
    .drop:nth-child(17){ animation-delay:1.6s }
    .drop:nth-child(18){ animation-delay:1.7s }
    .drop:nth-child(19){ animation-delay:1.8s }

    /* ·∫¢nh b√°nh gi·ªØa m√†n h√¨nh (GIF/PNG) */
    .intro{ position:fixed; inset:0; display:grid; place-items:center; z-index:2; }
    .cake{
      width:min(60vmin, 440px); height:auto; border-radius:18px;
      box-shadow: 0 18px 60px rgba(255,105,180,.3);
      border:3px solid rgba(255,205,227,.9);
      background:#fff; object-fit:cover;
    }
    .cake:hover{
  transform:scale(1.05);
  box-shadow:
    0 16px 40px rgba(255,105,180,.45),
    0 0 30px rgba(255,182,193,.4);
}

    /* Card thi·ªáp + n√∫t */
    .card{ 
      position:fixed; inset:0; display:grid; place-items:center; z-index:2; opacity:0; pointer-events:none;
      transition: opacity .8s ease;
    }
    .card.show{ opacity:1; pointer-events:auto; }
    .inner{
      width:min(92vw, 520px); background:#fff; color:#111; border-radius:16px;
      box-shadow:0 24px 80px rgba(0,0,0,.35); padding:20px; text-align:center;
      border:3px solid #ffcde3;
    }
    .inner img{ width:100%; border-radius:12px; display:block; }
    .btn{
      margin-top:18px; display:inline-block; padding:12px 18px; border-radius:999px; border:0;
      font-weight:700; text-decoration:none; color:white;
      background:linear-gradient(90deg,#ff8fb1,#ff6b9e);
      box-shadow:0 10px 24px rgba(255,107,158,.35);
    }
    .intro {
  opacity: 1;
  transition: opacity 1.2s ease;
}
.intro.hide {
  opacity: 0;
  pointer-events: none;
}
#greet {
  position: fixed;
  left: 50%;
  bottom: 10vh;
  transform: translateX(-50%);
  z-index: 120;
  padding: 12px 18px;
  border-radius: 12px;
  background: rgba(255, 255, 255, 0.9);
  color: #3a0c4a;
  font-weight: 700;
  max-width: min(92vw, 720px);
  text-align: center;
  box-shadow: 0 12px 30px rgba(0,0,0,.25);
  opacity: 0;
  pointer-events: none;
  transition: opacity .35s ease;
  white-space: pre-wrap;
}
#greet.show { opacity: 1; }
.card.fade { opacity: .2; transition: opacity .6s ease; }
  </style>
</head>
<body>
  <!-- N·ªÅn matrix -->
  <canvas id="matrix"></canvas>
  <canvas id="fx"></canvas>
  <!-- Ti√™u ƒë·ªÅ tr√™n c√πng -->
  <h1 class="title">üéâ Happy Birthday üéâ</h1>

  <!-- Ch·ªØ th·∫£ r∆°i: GI·ªÆ NGUY√äN √ù, d√πng Dancing Script -->
  <div class="rainWrap" aria-hidden="true">
    <div class="rain" id="rain">
      <span class="drop">C</span>
      <span class="drop">H</span>
      <span class="drop">√ö</span>
      <span class="drop">C</span>
      <span class="drop">&nbsp;</span>
      <span class="drop">M</span>
      <span class="drop">·ª™</span>
      <span class="drop">N</span>
      <span class="drop">G</span>
      <span class="drop">&nbsp;</span>
      <span class="drop">S</span>
      <span class="drop">I</span>
      <span class="drop">N</span>
      <span class="drop">H</span>
      <span class="drop">&nbsp;</span>
      <span class="drop">N</span>
      <span class="drop">H</span>
      <span class="drop">·∫¨</span>
      <span class="drop">T</span>
      <span class="drop">!</span>
    </div>
  </div>

 <!-- ·∫¢nh b√°nh cute gi·ªØa m√†n h√¨nh -->
<div class="intro">
  <img class="cake" id="cakeImg" src="" alt="B√°nh sinh nh·∫≠t cute"/>
</div>

<!-- Thi·ªáp cute + n√∫t m·ªü qu√† (hi·ªán sau 5s) -->
<section class="card" id="card">
  <div class="inner">
    <a href="galaxy_2.html" style="display:block;">
      <img id="mainCard" src="" alt="Thi·ªáp cute"/>
    </a>
  </div>
</section>
<div id="greet" aria-live="polite"></div>
<script>

  const LS_GREETING = 'greeting_text';
const GREETING = localStorage.getItem(LS_GREETING) || 'Ch√∫c b·∫°n tu·ªïi m·ªõi r·ª±c r·ª° & h·∫°nh ph√∫c! üíñ';
  // === L·∫•y ·∫£nh t·ª´ localStorage ho·∫∑c d√πng ·∫£nh m·∫∑c ƒë·ªãnh ===
const imgTopSrc =
  localStorage.getItem('img_birthday_top_dataurl') ||
  'assets/cute-cake.png';  // ·∫£nh b√°nh cute m·∫∑c ƒë·ªãnh

const imgCardSrc =
  localStorage.getItem('img_birthday_card_dataurl') ||
  'assets/card-cute.png';  // ·∫£nh thi·ªáp cute m·∫∑c ƒë·ªãnh

/* ====== Matrix Rain: ch·ªØ n·ªïi r√µ (scale theo DPR, vi·ªÅn + glow) ====== */
const fx = document.getElementById('fx');
const fxc = fx.getContext('2d');
function resizeFX(){
  const DPR = Math.max(1, devicePixelRatio||1);
  fx.width  = innerWidth * DPR; fx.height = innerHeight * DPR;
  fx.style.width = innerWidth + 'px'; fx.style.height = innerHeight + 'px';
  fxc.setTransform(DPR,0,0,DPR,0,0);
}
addEventListener('resize', resizeFX); resizeFX();

function burst(x, y, color='#ff69b4'){
  const parts = [];
  for(let i=0;i<60;i++){
    const a = Math.random()*Math.PI*2, v = 2+Math.random()*3;
    parts.push({x, y, vx: Math.cos(a)*v, vy: Math.sin(a)*v, life: 60});
  }
  let raf;
  (function tick(){
    fxc.fillStyle='rgba(0,0,0,0)'; // kh√¥ng ph·ªß n·ªÅn
    fxc.clearRect(0,0,innerWidth,innerHeight);
    parts.forEach(p=>{
      p.x+=p.vx; p.y+=p.vy; p.vy+=0.05; p.life--;
      fxc.fillStyle=`${color}`;
      fxc.globalAlpha = Math.max(0, p.life/60);
      fxc.beginPath(); fxc.arc(p.x, p.y, 2, 0, Math.PI*2); fxc.fill();
    });
    fxc.globalAlpha = 1;
    for(let i=parts.length-1;i>=0;i--) if(parts[i].life<=0) parts.splice(i,1);
    if(parts.length) raf=requestAnimationFrame(tick); else cancelAnimationFrame(raf);
  })();
}

function burstPattern() {
  burst(innerWidth*0.35, innerHeight*0.35, '#ff66a8');
  setTimeout(() => burst(innerWidth*0.65, innerHeight*0.40, '#ffd166'), 250);
  setTimeout(() => burst(innerWidth*0.50, innerHeight*0.30, '#9be7c4'), 500);
}
// B·∫Øn ph√°o hoa ngay khi trang load
window.addEventListener('load', () => {
  burstPattern();
});
// G·ªçi ph√°o hoa khi card hi·ªán
setTimeout(() => {
  document.getElementById('card').classList.add('show');
  burstPattern(); // d√πng l·∫°i pattern ƒë√£ t√°ch
}, 5000);

// G·ªçi ph√°o hoa khi card hi·ªán
setTimeout(()=>{
  document.getElementById('card').classList.add('show');
  document.querySelector('.intro')?.classList.add('hide'); // ·∫®n b√°nh üéÇ
  burst(innerWidth*0.35, innerHeight*0.35, '#ff66a8');
  setTimeout(()=>burst(innerWidth*0.65, innerHeight*0.4, '#ffd166'), 250);
  setTimeout(()=>burst(innerWidth*0.5, innerHeight*0.3, '#9be7c4'), 500);
}, 5000);



setTimeout(() => {
  const m = document.getElementById('matrix'); // s·ª≠a selector
  if (m) {
    m.style.transition = 'opacity 1.2s ease';
    m.style.opacity = 0;
  }
}, 5200);
window.addEventListener('load', () => {
  burstPattern();
  setTimeout(burstPattern, 400);
  setTimeout(burstPattern, 800);
});

// (tu·ª≥ ch·ªçn) n·ªï khi click v√†o thi·ªáp
document.getElementById('mainCard')?.addEventListener('click', (e)=>{
  const rect = e.target.getBoundingClientRect();
  burst(rect.left + rect.width/2, rect.top + rect.height/2, '#ff66a8');
});
const cvs = document.getElementById('matrix');
const ctx = cvs.getContext('2d');
const glyphs = 'HappyBirthdayüéÇ‚ú®';
let W,H,cols,drops,DPR;

function resize(){
  DPR = Math.max(1, window.devicePixelRatio || 1);
  W = cvs.width = Math.floor(innerWidth * DPR);
  H = cvs.height = Math.floor(innerHeight * DPR);
  cvs.style.width = innerWidth + 'px';
  cvs.style.height = innerHeight + 'px';
  ctx.setTransform(DPR,0,0,DPR,0,0);

  const step = 20; // ch·ªØ l·ªõn h∆°n ƒë·ªÉ d·ªÖ nh√¨n
  cols = Math.floor(innerWidth / step);
  drops = Array(cols).fill(0);
}
addEventListener('resize', resize); resize();

(function draw(){
  requestAnimationFrame(draw);
  // l·ªõp m·ªù ƒë·ªÉ t·∫°o v·ªát m∆∞a nh∆∞ng kh√¥ng che ·∫£nh
  ctx.globalCompositeOperation = 'source-over';
  ctx.fillStyle = 'rgba(255,240,245,0.08)';
  ctx.fillRect(0,0,innerWidth,innerHeight);

  const step = 20;
  ctx.font = 'bold 18px monospace';

  for(let i=0;i<drops.length;i++){
    const ch = glyphs[Math.floor(Math.random()*glyphs.length)];
    const x = i*step, y = drops[i]*step;

    // V·∫Ω outline tr·∫Øng + glow m√†u ƒë·ªÉ n·ªïi tr√™n n·ªÅn/·∫£nh
    const hue = (i*9 + performance.now()/25)%360;

    // vi·ªÅn (stroke) m·ªù ƒë·ªÉ t√°ch n·ªÅn
    ctx.lineWidth = 3;
    ctx.strokeStyle = 'rgba(255,255,255,0.85)';
    ctx.strokeText(ch, x, y);

    // ch·ªØ tr·∫Øng + b√≥ng ph√°t s√°ng m√†u
    ctx.shadowColor = `hsl(${hue} 90% 60%)`;
    ctx.shadowBlur = 12;
    ctx.fillStyle = '#CC00CC';
    ctx.fillText(ch, x, y);

    // reset shadow cho l·∫ßn sau
    ctx.shadowBlur = 0;

    if(y>H && Math.random()>0.965) drops[i]=0; else drops[i]++;
  }
})();

/* ====== ·∫¢nh ch√≠nh (thi·ªáp): n·∫øu user ch·ªçn ·∫£nh birthday th√¨ ∆∞u ti√™n d√πng ====== */
const LS_IMG_BIRTH = 'img_birthday_dataurl';
const saved = localStorage.getItem(LS_IMG_BIRTH);
if (saved) {
  document.getElementById('mainCard').src = saved;
}
// G√°n ·∫£nh v√†o 2 ph·∫ßn hi·ªÉn th·ªã
document.getElementById('cakeImg').src = imgTopSrc;
document.getElementById('mainCard').src = imgCardSrc;
/* ====== Sau 5s hi·ªán card thi·ªáp + n√∫t ====== */
setTimeout(()=> document.getElementById('card').classList.add('show'), 5000);


// ====== Hi·ªáu ·ª©ng ph√°o hoa ======
// ===== Hi·ªáu ·ª©ng khi b·∫•m v√†o thi·ªáp (m·ªü qu√†) =====
const mainCard = document.getElementById('mainCard');
mainCard.addEventListener('click', e => {
  e.preventDefault();

   // NEW: hi·ªÉn th·ªã l·ªùi ch√∫c ngay khi click
  const toast = document.getElementById('greet');
  toast.textContent = GREETING;
  toast.classList.add('show');
  // Hi·ªán ph√°o hoa
  const fwCanvas = document.createElement('canvas');
  fwCanvas.style.position = 'fixed';
  fwCanvas.style.inset = '0';
  fwCanvas.style.zIndex = '100';
  fwCanvas.style.pointerEvents = 'none';
  document.body.appendChild(fwCanvas);
  const fctx = fwCanvas.getContext('2d');
  fwCanvas.width = innerWidth;
  fwCanvas.height = innerHeight;

  let fireworks = [];

  function spawnFirework(){
    const x = Math.random()*innerWidth;
    const y = Math.random()*innerHeight*0.6;
    const color = `hsl(${Math.random()*360}, 100%, 65%)`;
    for(let i=0;i<50;i++){
      const a = Math.random()*Math.PI*2;
      const s = Math.random()*5+2;
      fireworks.push({
        x, y, vx: Math.cos(a)*s, vy: Math.sin(a)*s,
        life: 80, color
      });
    }
  }

  function updateFW(){
    fctx.fillStyle = 'rgba(0,0,0,0.15)';
    fctx.fillRect(0,0,fwCanvas.width,fwCanvas.height);
    fireworks.forEach((p,i)=>{
      p.x += p.vx; p.y += p.vy; p.vy += 0.05; p.life--;
      if(p.life<=0) fireworks.splice(i,1);
      fctx.fillStyle = p.color;
      fctx.globalAlpha = Math.max(p.life/80, 0);
      fctx.fillRect(p.x,p.y,2,2);
      fctx.globalAlpha = 1;
    });
    requestAnimationFrame(updateFW);
  }
  updateFW();

  const interval = setInterval(spawnFirework, 250);

  // Sau 5 gi√¢y t·ª± chuy·ªÉn trang
  setTimeout(()=>{
    clearInterval(interval);
    fwCanvas.remove();
     toast.classList.remove('show');
    location.href = 'galaxy_2.html';
  }, 5000);
});


</script>
</body>
</html>
