<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Birthday ‚ú®</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Playpen+Sans:wght@400;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
  overflow:hidden;
  color:#fff;
  font-family:"Playpen Sans",sans-serif;
  background:
    radial-gradient(circle at 50% 30%,
      rgba(255,170,200,1) 0%,
      rgba(255,120,180,1) 40%,
      rgba(90,0,60,1) 100%);
}

/* kho·∫£ng c√°ch gi·ªØa c√°c d√≤ng ch·ªØ */
.rainAllWrap{
  position:fixed;left:50%;top:50%;
  transform:translate(-50%,-60%);
  width:100%;max-width:90vw;text-align:center;z-index:5;
}
.rainWrap{opacity:0;margin-bottom:clamp(26px,4vw,48px);}
.rainWrap.show{opacity:1;}

.rain{
  font-weight:700;
  font-size:clamp(20px,3.5vw,42px);
  color:#ff2b2b;
  text-shadow:
    0 0 10px rgba(255,50,80,0.9),
    0 0 24px rgba(255,0,70,0.8),
    0 3px 8px rgba(0,0,0,0.6);
  font-family:"Dancing Script",cursive;
}

.line3 .rain{
  font-family:"Playpen Sans",sans-serif;
  font-size:clamp(20px,3vw,36px);
  text-shadow:
    0 0 8px rgba(255,60,90,0.9),
    0 0 22px rgba(255,20,70,0.7),
    0 3px 8px rgba(0,0,0,0.6);
}

/* drop letters */
.drop{display:inline-block;opacity:0;transform:translateY(-40px);}
@keyframes dropIn{
  0%{opacity:0;transform:translateY(-40px);}
  60%{opacity:1;transform:translateY(8px);}
  80%{transform:translateY(-4px);}
  100%{opacity:1;transform:translateY(0);}
}
.drop.animate{animation:dropIn 1.8s ease-out forwards;}

/* gift box */
.giftWrap{
  position:fixed;left:0;right:0;bottom:12vh;
  display:grid;place-items:center;z-index:6;
}
.giftEmoji{
  font-size:clamp(80px,12vw,130px);
  animation:shake 1s infinite;cursor:pointer;
}
@keyframes shake{
  0%,100%{transform:translateY(0);}
  50%{transform:translateY(-6px);}
}
.giftEmoji.open{animation:none;}
.giftEmoji::before{
  content:"üéÅ";position:absolute;top:0;left:0;right:0;
  opacity:0;pointer-events:none;
}
.giftEmoji.open::before{
  opacity:1;animation:lidFlip .6s ease-out forwards;
}
@keyframes lidFlip{
  0%{transform:translateY(0) rotateX(0);}
  100%{transform:translateY(-60px) rotateX(110deg);}
}
</style>
</head>

<body>

<!-- ch·ªØ -->
<div class="rainAllWrap">
  <div class="rainWrap line1">
    <div class="rain">
      <span class="drop">C</span><span class="drop">H</span><span class="drop">√ö</span><span class="drop">C</span><span class="drop">&nbsp;</span>
      <span class="drop">M</span><span class="drop">·ª™</span><span class="drop">N</span><span class="drop">G</span><span class="drop">&nbsp;</span>
      <span class="drop">S</span><span class="drop">I</span><span class="drop">N</span><span class="drop">H</span><span class="drop">&nbsp;</span>
      <span class="drop">N</span><span class="drop">H</span><span class="drop">·∫¨</span><span class="drop">T</span><span class="drop">!</span>
    </div>
  </div>

  <div class="rainWrap line2">
    <div class="rain">
      <span class="drop">B</span><span class="drop">·∫°</span><span class="drop">n</span>
      <span class="drop">&nbsp;</span><span class="drop">i</span><span class="drop">u</span>
    </div>
  </div>

  <div class="rainWrap line3">
    <div class="rain">
      <span class="drop">2</span><span class="drop">9</span><span class="drop">+</span>
    </div>
  </div>
</div>

<!-- qu√† -->
<div class="giftWrap">
  <div class="giftEmoji" id="giftEmoji">üéÅ</div>
</div>

<!-- nh·∫°c -->
<audio id="bgm" preload="auto" loop playsinline style="display:none"></audio>

<script>
/* ch·ªØ r∆°i */
function playLine(line, next){
  line.classList.add('show');
  const letters = line.querySelectorAll('.drop');
  letters.forEach((s,i)=>{
    s.style.animationDelay = (0.1*(i+1))+'s';
    s.classList.add('animate');
  });
  setTimeout(()=> next && next(), (0.1*letters.length+1.8)*1000);
}
const L1 = document.querySelector('.line1');
const L2 = document.querySelector('.line2');
const L3 = document.querySelector('.line3');
playLine(L1,()=>playLine(L2,()=>playLine(L3)));

/*********** MUSIC ***********/
const DEFAULT_BGM = "assets/default-bgm.mp3"; // file nh·∫°c m·∫∑c ƒë·ªãnh c·ªßa b·∫°n
const KEY_BGM = "bgm_blob";
const audio = document.getElementById("bgm");
audio.volume = 0.45;

/* open IndexedDB */
function openDB(){
  return new Promise((resolve,reject)=>{
    const req=indexedDB.open("birthdayDB",1);
    req.onupgradeneeded=()=>req.result.createObjectStore("images");
    req.onsuccess=()=>resolve(req.result);
    req.onerror=()=>reject(req.error);
  });
}
async function dbGet(key){
  const db = await openDB();
  return new Promise((resolve,reject)=>{
    const tx=db.transaction("images","readonly");
    const req=tx.objectStore("images").get(key);
    req.onsuccess=()=>resolve(req.result||null);
    req.onerror=()=>reject(req.error);
  });
}

/* load nh·∫°c user ho·∫∑c m·∫∑c ƒë·ªãnh */
(async ()=>{
  const blob = await dbGet(KEY_BGM);
  if(blob){
    audio.src = URL.createObjectURL(blob);
  } else {
    audio.src = DEFAULT_BGM;
  }

  const allowed = sessionStorage.getItem("allow_music")==="1";
  sessionStorage.removeItem("allow_music");

  const playNow = ()=>audio.play().catch(()=>{
    window.addEventListener("pointerdown",()=>audio.play(),{once:true});
  });

  if(allowed) playNow();
})();

/*********** CLICK H·ªòP QU√Ä ***********/
document.getElementById("giftEmoji").addEventListener("click",()=>{
  location.href="galaxy_2.html";
});
</script>

</body>
</html>
