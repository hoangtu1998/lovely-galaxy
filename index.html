<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üíñ M·ªü Qu√† B√≠ M·∫≠t üíñ</title>

  <!-- Font h·ªón h·ª£p: ch·ªØ m·ªÅm + s·ªë tr√≤n -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@600&family=Bubblegum+Sans&display=swap" rel="stylesheet">

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="theme-color" content="#0b0720">

  <!-- Cho Android -->
  <meta name="mobile-web-app-capable" content="yes">

  <!-- Cho iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- manifest PWA -->
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">

  <style>
    :root{
      /* B·∫£ng m√†u: h·ªìng + t√≠m + xanh l√° + v√†ng, ki·ªÉu aurora */
      --bg:#050318;
      --card:rgba(10,12,35,0.92);
      --ink:#fdfbff;
      --muted:#c7c9ff;

      --accent-pink:#f472b6;
      --accent-purple:#a855f7;
      --accent-green:#6ee7b7;
      --accent-yellow:#facc6b;

      --shadow-soft:0 18px 40px rgba(5,10,40,0.9);
      --radius-lg:22px;
    }

    *{ box-sizing:border-box; }

    html,body{
      height:100%;
      margin:0;
      touch-action:manipulation;
    }

    body{
      /* n·ªÅn aurora: t√≠m + h·ªìng + xanh + v√†ng */
      background:
        radial-gradient(circle at 0% 0%,
          rgba(244,114,182,0.35) 0%,
          transparent 55%),
        radial-gradient(circle at 100% 0%,
          rgba(250,204,21,0.30) 0%,
          transparent 55%),
        radial-gradient(circle at 15% 90%,
          rgba(45,212,191,0.32) 0%,
          transparent 55%),
        linear-gradient(180deg,
          #0b0720 0%,
          #15103b 35%,
          #21124b 65%,
          #2b153e 100%);
      background-attachment:fixed;

      color:var(--ink);
      font-family:'Quicksand', sans-serif;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:16px 0;
      min-height:100vh;
    }

    h1{
      font-family:'Pacifico', cursive;
      font-size:clamp(24px,4vw,32px);
      color:#ffeefc;
      margin:8px 0 18px;
      text-align:center;
      max-width:90vw;
      line-height:1.2;
      letter-spacing:1px;
      text-shadow:
        0 0 12px rgba(248,250,252,0.6),
        0 0 24px rgba(244,114,182,0.7);
    }

    .wrap{
      width:100%;
      max-width:420px;
      display:grid;
      place-items:center;
      padding:0 16px;
    }

    .card{
      width:100%;
      background:var(--card);
      border-radius:var(--radius-lg);
      border:1px solid rgba(161,172,255,0.45);
      box-shadow:var(--shadow-soft);
      padding:20px 16px;
      display:grid;
      grid-template-columns:1fr;
      gap:16px;
      transition:transform .15s ease;
      backdrop-filter:blur(18px);
      -webkit-backdrop-filter:blur(18px);
      position:relative;
      overflow:hidden;
    }

    /* l·ªõp √°nh s√°ng nh·∫π b√™n trong card */
    .card::before{
      content:"";
      position:absolute;
      inset:-20%;
      background:
        radial-gradient(circle at 0% 0%,
          rgba(244,114,182,0.18) 0%,
          transparent 55%),
        radial-gradient(circle at 100% 0%,
          rgba(250,204,21,0.12) 0%,
          transparent 60%),
        radial-gradient(circle at 20% 100%,
          rgba(45,212,191,0.16) 0%,
          transparent 55%);
      opacity:0.9;
      pointer-events:none;
    }

    .card > *{
      position:relative;
      z-index:1;
    }

    .left{
      display:flex;
      justify-content:center;
    }

    /* vi·ªÅn ·∫£nh ki·ªÉu gradient mix 4 m√†u */
    .frame{
      width:200px;
      max-width:70vw;
      border-radius:20px;
      padding:3px;
      background:conic-gradient(
        from 140deg,
        var(--accent-pink),
        var(--accent-yellow),
        var(--accent-green),
        var(--accent-purple),
        var(--accent-pink)
      );
      box-shadow:0 12px 30px rgba(15,23,42,0.95);
    }

    .frame img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      border-radius:18px;
      aspect-ratio:1/1;
    }

    .right{
      display:grid;
      gap:12px;
      align-content:start;
    }

    /* √¥ hi·ªÉn th·ªã m·∫≠t kh·∫©u: t·ªëi h∆°n nh∆∞ng v·∫´n s√°ng v√† trong */
    .display{
      height:48px;
      border-radius:18px;
      padding:0 12px;
      background:linear-gradient(135deg,
        rgba(15,23,42,0.9),
        rgba(30,64,175,0.7));
      border:1px solid rgba(191,219,254,0.7);
      box-shadow:
        0 0 18px rgba(59,130,246,0.55),
        inset 0 0 10px rgba(15,23,42,0.9);
      backdrop-filter:blur(12px);
      -webkit-backdrop-filter:blur(12px);

      display:flex;
      align-items:center;
      justify-content:flex-end;
      font-size:24px;
      color:#fef9c3; /* v√†ng kem s√°ng */
      letter-spacing:5px;
      font-family:'Bubblegum Sans', cursive;
    }

    .pad{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:10px;
      user-select:none;
    }

    button.key{
      height:54px;
      border-radius:999px;
      border:none;
      background:
        radial-gradient(circle at 0% 0%, rgba(250,204,21,0.35) 0%, transparent 55%),
        radial-gradient(circle at 100% 0%, rgba(45,212,191,0.3) 0%, transparent 55%),
        linear-gradient(135deg,
          rgba(30,64,175,1),
          rgba(79,70,229,1),
          rgba(168,85,247,1));
      box-shadow:0 10px 26px rgba(15,23,42,0.9);
      font-size:20px;
      font-family:'Bubblegum Sans', cursive;
      color:#fefce8;
      cursor:pointer;
      transition:transform .1s, box-shadow .2s, filter .2s, background .25s;
      -webkit-tap-highlight-color:transparent;
      touch-action:manipulation;
      display:flex;
      justify-content:center;
      align-items:center;
    }

    button.key:hover{
      filter:brightness(1.08);
      box-shadow:0 12px 30px rgba(15,23,42,1);
    }

    button.key:active{
      transform:scale(.96);
      box-shadow:0 6px 18px rgba(15,23,42,0.9);
    }

    /* n√∫t OK üíñ ‚Äì thi√™n v·ªÅ h·ªìng + v√†ng */
    .key.ok{
      background:
        radial-gradient(circle at 0% 0%, rgba(250,204,21,0.35) 0%, transparent 55%),
        linear-gradient(135deg,
          #f97316,
          #f472b6,
          #ec4899);
      box-shadow:0 12px 32px rgba(248,113,166,0.8);
      color:#fffaf5;
      border:none;
    }

    .key.ok:hover{
      filter:brightness(1.1);
      box-shadow:0 14px 36px rgba(248,113,166,0.9);
    }

    /* n√∫t x√≥a ‚Äì t√≠m + xanh l√° d·ªãu h∆°n */
    .key.del{
      background:
        linear-gradient(135deg,
          rgba(22,101,52,0.95),
          rgba(21,128,61,0.9),
          rgba(56,189,248,0.95));
      color:#e0f9ff;
      font-family:'Quicksand', sans-serif;
      font-size:18px;
      box-shadow:0 10px 26px rgba(5,46,22,0.9);
    }

    .foot{
      text-align:center;
      color:var(--muted);
      font-size:12px;
      line-height:1.4;
      font-family:'Quicksand', sans-serif;
    }

    .foot a{
      color:#bfdbfe;
      text-decoration:none;
    }
    .foot a:hover{
      text-decoration:underline;
    }

    .links{
      text-align:center;
      margin:12px 0 0;
      font-size:14px;
      color:var(--muted);
    }
    .links a{
      color:#a5b4fc;
      text-decoration:none;
    }
    .links a:hover{
      text-decoration:underline;
    }

    @media(max-width:820px){
      .card{ grid-template-columns:1fr; }
    }
  </style>
</head>
<body>
  <h1>üå∏ Nh·∫≠p Pass ƒëi ng∆∞·ªùi ƒë·∫πp üå∏</h1>
  <section class="wrap">
    <div class="card" id="card">
      <div class="left">
        <div class="frame">
          <img id="indexPic" src="assets/OIP.webp" alt="·∫¢nh index"/>
        </div>
      </div>
      <div class="right">
        <div class="display" id="disp"></div>
        <div class="pad">
          <button class="key" data-k="1">1</button>
          <button class="key" data-k="2">2</button>
          <button class="key" data-k="3">3</button>
          <button class="key" data-k="4">4</button>
          <button class="key" data-k="5">5</button>
          <button class="key" data-k="6">6</button>
          <button class="key" data-k="7">7</button>
          <button class="key" data-k="8">8</button>
          <button class="key" data-k="9">9</button>
          <button class="key del" data-k="del">‚å´</button>
          <button class="key" data-k="0">0</button>
          <button class="key ok" data-k="ok">üíñ</button>
        </div>
        <div class="foot">V√†o <a href="settings.html">C√†i ƒë·∫∑t</a> ƒë·ªÉ ch·ªçn ·∫£nh & m·∫≠t kh·∫©u d·ªÖ th∆∞∆°ng üíó</div>
      </div>
    </div>
    <div class="links"><a href="settings.html">‚öôÔ∏è C√†i ƒë·∫∑t</a></div>
  </section>

<script>
/* ==== m·∫≠t kh·∫©u v·∫´n y nh∆∞ b·∫°n ƒëang d√πng ==== */
const LS_PW = 'userPassword';

const disp = document.getElementById('disp');
const card = document.getElementById('card');
let buf = "";

/* L·∫•y m·∫≠t kh·∫©u ƒëang l∆∞u */
function getSecret(){
  return (localStorage.getItem(LS_PW)||''.trim()) || "1234";
}

/* c·∫≠p nh·∫≠t √¥ hi·ªÉn th·ªã pass (d√πng d·∫•u ch·∫•m) */
function updateDisp(){
  disp.textContent = buf.replace(/./g,'‚Ä¢');
}

/* hi·ªáu ·ª©ng l·∫Øc khi sai pass */
function shake(){
  card.style.transition='transform .08s';
  card.style.transform='translateX(-5px)';
  setTimeout(()=> card.style.transform='translateX(5px)',70);
  setTimeout(()=> card.style.transform='translateX(0)',140);
}

function submit(){
  if(buf===getSecret()){
    localStorage.setItem('gift_unlocked','1');

    // Cho ph√©p autoplay ·ªü trang birthday (v√¨ c√≥ t∆∞∆°ng t√°c ng∆∞·ªùi d√πng)
    sessionStorage.setItem('allow_music','1');

    location.href='birthday.html';
  }else{
    buf=""; updateDisp(); shake();
  }
}

/* x·ª≠ l√Ω b·∫•m ph√≠m keypad */
function press(k){
  if(k==='ok') return submit();
  if(k==='del'){
    buf = buf.slice(0,-1);
    return updateDisp();
  }
  if(/^[0-9]$/.test(k) && buf.length<12){
    buf += k;
    updateDisp();
  }
}

/* g√°n click cho c√°c n√∫t */
document.querySelectorAll('.key').forEach(b=>{
  b.addEventListener('click',()=>press(b.dataset.k));
});

/* g√°n ph√≠m c·ª©ng b√†n ph√≠m th·∫≠t (desktop) */
addEventListener('keydown',e=>{
  if(e.key>='0'&&e.key<='9') press(e.key);
  if(e.key==='Backspace')    press('del');
  if(e.key==='Enter')        press('ok');
});

/* render ban ƒë·∫ßu */
updateDisp();

/* ==== l·∫•y ·∫£nh Index t·ª´ IndexedDB ==== */
const DB_NAME = 'birthdayDB';
const DB_VER  = 1;
const STORE   = 'images';
const INDEX_KEY = 'img_index_main'; // ·∫£nh index l∆∞u b·∫±ng key n√†y trong settings m·ªõi

function openDB() {
  return new Promise((resolve, reject) => {
    const req = indexedDB.open(DB_NAME, DB_VER);
    req.onupgradeneeded = () => {
      const db = req.result;
      if (!db.objectStoreNames.contains(STORE)) {
        db.createObjectStore(STORE);
      }
    };
    req.onsuccess = () => resolve(req.result);
    req.onerror   = () => reject(req.error);
  });
}

async function getImageFromDB(key){
  const db = await openDB();
  return new Promise((resolve, reject) => {
    const tx = db.transaction(STORE,'readonly');
    const req = tx.objectStore(STORE).get(key);
    req.onsuccess = () => resolve(req.result || null);
    req.onerror   = () => reject(req.error);
  });
}

/* load ·∫£nh Index khi m·ªü trang */
(async function loadIndexPic(){
  const imgEl = document.getElementById('indexPic');

  try {
    const blob = await getImageFromDB(INDEX_KEY);
    if (blob) {
      const url = URL.createObjectURL(blob);
      imgEl.src = url;  // d√πng ·∫£nh user upload
    } else {
      imgEl.src = "assets/OIP.webp";
    }
  } catch (err) {
    console.error('Kh√¥ng load ƒë∆∞·ª£c ·∫£nh Index t·ª´ IndexedDB:', err);
    imgEl.src = "assets/OIP.webp";
  }
})();

/* ==== optional: PWA service worker ==== */
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('./sw.js').catch(()=>{});
}
</script>
</body>
</html>
